<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>登录 - 高校网盘</title>
    <!-- 引入 Bootstrap 5 -->
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .card { width: 400px; border: none; shadow: 0 0 20px rgba(0,0,0,0.1); }
        .captcha-box { cursor: pointer; }
    </style>
</head>
<body>

<div class="card p-4">
    <h3 class="text-center mb-4">☁️ 高校网盘登录</h3>
    <form id="loginForm">
        <div class="mb-3">
            <label>用户名</label>
            <input type="text" class="form-control" name="username" required>
        </div>
        <div class="mb-3">
            <label>密码</label>
            <input type="password" class="form-control" name="password" required>
        </div>
        <div class="mb-3">
            <label>验证码</label>
            <div class="input-group">
                <input type="text" class="form-control" name="captcha" required>
                <!-- 验证码图片，点击刷新 -->
                <img src="/api/user/captcha" class="captcha-box" id="captchaImg" title="点击刷新">
            </div>
        </div>
        <button type="submit" class="btn btn-primary w-100">登录</button>
        <div class="text-center mt-3">
            <a href="/register">没有账号？去注册</a>
        </div>
    </form>
</div>

<!-- 引入 jQuery -->
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
    // 1. 点击刷新验证码 (加个时间戳防止浏览器缓存)
    $('#captchaImg').click(function() {
        $(this).attr('src', '/api/user/captcha?t=' + new Date().getTime());
    });

    // 2. 提交表单
    $('#loginForm').submit(function(e) {
        e.preventDefault(); // 阻止表单默认提交

        // 收集数据转成 JSON
        var data = {
            username: $('input[name="username"]').val(),
            password: $('input[name="password"]').val(),
            captcha: $('input[name="captcha"]').val()
        };

        $.ajax({
            url: '/api/user/login',
            type: 'POST',
            contentType: 'application/json', // 必须指定 JSON
            data: JSON.stringify(data),      // 对象转 JSON 字符串
            success: function(res) {
                if (res.code === 200) {
                    location.href = '/index'; // 登录成功跳首页
                } else {
                    alert(res.msg); // 失败提示
                    $('#captchaImg').click(); // 刷新验证码
                }
            },
            error: function() {
                alert('服务器错误');
            }
        });
    });
</script>
</body>
</html>